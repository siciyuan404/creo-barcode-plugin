# Creo 条形码插件使用说明

## 概述

Creo Barcode Plugin 是一款用于 PTC Creo 8.0+ 的插件，可根据零件名称在工程图中自动生成条形码。

## 系统要求

- PTC Creo 8.0 或更高版本（需安装 Toolkit）
- Windows 操作系统
- CMake 3.16+
- C++17 兼容编译器

## 环境  


### 您的 Creo 软件目录结构

| 项目 | 路径 |
| :--- | :--- |
| **Toolkit 目录** | `C:\Program Files\PTC\Creo 8.0.9.0\Common Files\protoolkit` |
| **protk.dat 文件** | `C:\Program Files\PTC\Creo 8.0.9.0\Common Files\protoolkit\protk.dat` |
| **插件目录** | `C:\Program Files\PTC\Creo 8.0.9.0\Common Files\protoolkit\protk_appls` |
| **Toolkit 头文件** | `C:\Program Files\PTC\Creo 8.0.9.0\Common Files\protoolkit\includes` |
| **Toolkit 库文件** | `C:\Program Files\PTC\Creo 8.0.9.0\Common Files\protoolkit\x86e_win64` |


## 安装步骤

### 1. 编译插件

```bash
# 进入插件目录
cd creo-barcode-plugin

# 创建构建目录
mkdir build
cd build

# 配置（指定 Creo Toolkit 路径）
cmake -DCREO_TOOLKIT_DIR="C:/Program Files/PTC/Creo 8.0.9.0/Common Files/protoolkit" ..

# 编译
cmake --build .
```

编译成功后，生成的文件位于：
- DLL: `build/bin/Debug/creo_barcode.dll`
- 测试: `build/bin/Debug/unit_tests.exe`

### 2. 注册插件

**方法一：修改 protk.dat 文件**

编辑 `C:\Program Files\PTC\Creo 8.0.9.0\Common Files\protoolkit\protk.dat`，添加：

```
NAME creo_barcode
STARTUP dll
EXEC_FILE C:\path\to\creo_barcode.dll
TEXT_DIR C:\path\to\resources
END
```

**方法二：复制到插件目录**

将 `creo_barcode.dll` 复制到：
`C:\Program Files\PTC\Creo 8.0.9.0\Common Files\protoolkit\protk_appls\`

## 功能说明

### 1. 单个条形码生成

1. 在 Creo 中打开包含零件的工程图
2. 点击菜单栏中的 **条形码** > **生成条形码**
3. 在设置对话框中配置参数：
   - **条形码类型**：CODE_128、CODE_39、QR_CODE、DATA_MATRIX、EAN_13
   - **宽度**：50-1000 像素
   - **高度**：20-500 像素
   - **边距**：0-50 像素
   - **DPI**：72-600
   - **显示文本**：是否在条形码下方显示数据
4. 点击确定，条形码将自动插入到工程图中

### 2. 批量处理

1. 点击菜单栏中的 **条形码** > **批量生成**
2. 选择多个工程图文件
3. 插件将自动为每个工程图生成对应的条形码
4. 处理完成后显示结果摘要

### 3. 数据同步检查

当零件名称发生变化时，插件会：
- 自动检测条形码数据与当前零件名称是否一致
- 显示不同步警告
- 提供更新选项，可一键重新生成条形码

## 配置文件

默认配置文件位置：
- Windows: `%APPDATA%\CreoBarcodePlugin\config.json`

配置示例：
```json
{
    "version": "1.0",
    "defaultBarcodeType": "CODE_128",
    "defaultWidth": 200,
    "defaultHeight": 80,
    "defaultShowText": true,
    "defaultDpi": 300,
    "outputDirectory": "%TEMP%/creo_barcode",
    "recentFiles": []
}
```

## 支持的条形码类型

| 类型        | 说明           | 适用场景           |
| ----------- | -------------- | ------------------ |
| CODE_128    | 高密度条形码   | 通用，推荐使用     |
| CODE_39     | 字母数字条形码 | 工业标准           |
| QR_CODE     | 二维码         | 需要存储更多信息时 |
| DATA_MATRIX | 二维矩阵码     | 小空间高密度       |
| EAN_13      | 商品条形码     | 产品标识           |

## 特殊字符处理

插件会自动编码零件名称中的特殊字符，确保条形码兼容性。

## 装配体支持

对于装配体工程图，插件会：
1. 自动识别装配体类型
2. 列出所有子零件
3. 允许用户选择要生成条形码的零件

## 故障排除

| 问题           | 解决方案                         |
| -------------- | -------------------------------- |
| 插件无法加载   | 检查 Creo 版本是否 ≥ 8.0         |
| 条形码生成失败 | 检查零件名称是否包含不支持的字符 |
| 图像插入失败   | 确保输出目录有写入权限           |

## 运行测试

```bash
cd build
ctest --output-on-failure
```

## 技术支持

如遇问题，请查看日志文件或联系技术支持。




cd creo-barcode-plugin
rmdir /s /q build
mkdir build
cd build
cmake -DCREO_TOOLKIT_DIR="C:/Program Files/PTC/Creo 8.0.9.0/Common Files/protoolkit" ..
cmake --build . --config Release